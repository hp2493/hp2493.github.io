<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: Setting path fills</title>
		<script type="text/javascript" src="d3.js"></script>
		<style type="text/css">
			/* No style rules here yet */		
		</style>
	</head>
	<body>
		<script type="text/javascript">

			//Width and height
			var w = 500;
			var h = 300;

			//Define map projection
			var projection = d3.geoAlbersUsa()
								   .translate([w/2, h/2])
								   .scale([500]);

			//Define path generator
			var path = d3.geoPath()
							 .projection(projection);

			//Create SVG element
			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);
						
			

			//Load in GeoJSON data
			d3.json("us-states.json") 
						.then(function(json) {
				
				//Bind data and create one path per GeoJSON feature
				svg.selectAll("path")
				   .data(json.features)
				   .enter()
				   .append("path")
				   .attr("d", path)
				   .style("fill", "#ccc")
				.style("stroke", "white");
				   
				   d3.csv("cbsa.csv") 
				.then(function(data){
					
					   
					var xPosition = function(d){
						// console.log(projection([d.lon, d.lat]))
						
						return projection([d.lon, d.lat])[0]-4
					}
					var yPosition = function(d) {
						return projection([d.lon, d.lat])[1]-4
					}
				   	svg.selectAll("rect")
					   .data(data)
					   .enter()
					   .append("rect")
					   .attr("x", xPosition)
					   .attr("y", yPosition)
					   .attr("width", 8)
					.attr("height", 8)
					.attr("fill", "blue")
					.attr("opacity", ".5")
					   
					   .on("mouseover", function(d){
	   					var xPosition = parseFloat(d3.select(this).attr("x")) 
	   					var yPosition = parseFloat(d3.select(this).attr("y")) 
						   
					   	svg.append("text")
						   .attr("id", "tooltip")
					   .attr("x", xPosition)
					   .attr("y", yPosition)
					   .attr("font-family", "sans-serif")
					   .attr("font-size", "11px")
					   .attr("font-weight", "bold")
					   .attr("fill", "black")
						   
					   .text(d.CBSA)
						   
					   })
					   .on("mouseout", function() {
			   
							//Remove the tooltip
							d3.select("#tooltip").remove();
					
					   })

					   

				   })
				   
				   d3.csv("2016_fires_clean.csv")
				   .then(function(data){ 
					   
					   	
					   
					svg.selectAll("circle")
					   .data(data)
					   .enter()
					   .append("circle")
					   .attr("cx", function(d) {
						   console.log(projection([d.lon, d.lat]))
						   return projection([d.lon, d.lat])[0];
					   })
					   .attr("cy", function(d) {
						   return projection([d.lon, d.lat])[1];
					   })
					   .attr("r", 10)
					   
							//   .attr("r", function(d) {
							// return Math.sqrt(parseInt(d.acres) * 0.00004);
							// 						   })

				   })
			});
			
		</script>
	</body>
</html>